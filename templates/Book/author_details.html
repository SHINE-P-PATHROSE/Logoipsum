{% extends "base.html" %}
{% load static %}
{% block content %}
<body>
    <div class="container mt-4">
        <h1 class="mb-4">Author Details</h1>

        <!-- Author Card -->
        <div class="card mb-4 shadow-sm">
            <div class="card-body">
                <h2 class="card-title">{{ author.name }}</h2>
                <p><strong>Username:</strong> {{ author.username }}</p>
                <p><strong>Email Address:</strong> {{ author.email }}</p>
                <p><strong>Action Status:</strong> {{ author.action_status|yesno:"Active,Inactive" }}</p>
            </div>
        </div>

        <!-- Books Section -->
        <h2 class="mt-5">Books by {{ author.name }}</h2>
        <div class="table-responsive">
            <table class="table table-bordered table-hover mt-3">
                <thead class="thead-light">
                    <tr>
                        <th>No</th>
                        <th>Book Name</th>
                        <th>Created Date</th>
                        <th>Actions</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in books %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ book.book_name }}</td>
                        <td>{{ book.create_date|date:"F j, Y" }}</td>
                        <td>
                            <a href="{% url 'edit_book' book.id %}" class="btn btn-warning btn-sm">Edit</a>
                        </td>
                        <td>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="bookStatus{{ book.id }}"
                                       {% if book.status %}checked{% endif %}
                                       onchange="updateBookStatus({{ book.id }}, this.checked)">
                                <label class="form-check-label" for="bookStatus{{ book.id }}">
                                    {% if book.status %} Available {% else %} Unavailable {% endif %}
                                </label>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center">No books found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script>
    function getCSRFToken() {
        // Get CSRF token from the cookies
        let cookieValue = null;
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.startsWith('csrftoken=')) {
                cookieValue = decodeURIComponent(cookie.substring('csrftoken='.length));
                break;
            }
        }
        return cookieValue;
    }

    function updateBookStatus(bookId, isChecked) {
        // Construct the status based on the checkbox state
        let status = isChecked ? 1 : 0;

        // Make an AJAX request to update the book status
        fetch(`/update_book_status/${bookId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCSRFToken()  // Pass the CSRF token
            },
            body: JSON.stringify({
                'status': status
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Optionally show a success message or update the UI
                alert('Book status updated successfully!');
            } else {
                alert('Failed to update book status');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while updating book status');
        });
    }
</script>

</body>
{% endblock %}
